Create an EC2 instance using AWS CloudFormation (YAML template) and automatically install Apache web server (httpd) using UserData, then verify the website from a browser.

Part A — Create Key Pair (One-time setup)
Step A1: Open EC2 Key Pairs
AWS Console → Search EC2
Left menu → Key Pairs (under “Network & Security”)
Click Create key pair
Step A2: Create key pair
Name: pemkeypair (any name is fine)
Key pair type: RSA
Private key file format: .pem
Click Create key pair
A file will download like: pemkeypair.pem
Note: CloudFormation uses key pair NAME (example: pemkeypair), not the file name extension.

Part B — Create CloudFormation Template File (Amazon Linux 2023 + Apache)
Create YAML file on your computer
Open Notepad
Paste the full YAML template given below
Save as: ec2-apache-al2023.yaml
Save type: All files
Encoding: UTF-8 (if asked)

Full CloudFormation Template (Amazon Linux 2023)
Important:
Do not add .pem anywhere.
You will select Key Pair from dropdown during stack creation later on.
AWSTemplateFormatVersion: "2010-09-09"
Description: Launch EC2 (Amazon Linux 2023) and install Apache

Parameters:
  KeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: Select an existing EC2 Key Pair

  AmazonLinux2023AMI:
    Type: AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>
    Default: /aws/service/ami-amazon-linux-latest/al2023-ami-kernel-default-x86_64

Resources:
  WebServerSG:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Allow SSH and HTTP
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0

  WebServerInstance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t3.micro
      KeyName: !Ref KeyName
      ImageId: !Ref AmazonLinux2023AMI
      SecurityGroupIds:
        - !Ref WebServerSG
      UserData:
        Fn::Base64: |
          #!/bin/bash
          dnf update -y
          dnf install -y httpd
          systemctl enable httpd
          systemctl start httpd
          echo "<h1>Apache Installed via CloudFormation (Amazon Linux 2023)</h1>" > /var/www/html/index.html

Outputs:
  WebsiteURL:
    Description: Apache Website URL
    Value: !Sub "http://${WebServerInstance.PublicDnsName}"

Part C — Create CloudFormation Stack (Console Steps)
Step C1: Open CloudFormation
AWS Console → Search CloudFormation
Click Stacks
Click Create stack → With new resources (standard)
Step C2: Prepare template (select correct options)
Under Prepare template:
Select Choose an existing template
Under Template source:
Select Upload a template file
Click Choose file → select ec2-apache-al2023.yaml
Click Next

Part D — Specify Stack Details
Step D1: Stack name
Stack name: EC2-Apache-AL2023
Click Next
Step D2: Parameters
Under KeyName, select your key pair name from dropdown [Example: pemkeypair]
Click Next

Part E — Configure Stack Options (keep default)
Leave everything as default
Click Next

Part F — Review and Create
Scroll down
Click Create stack

Part G — Monitor Stack Creation
Wait for Stack status to become: CREATE_COMPLETE
Open the stack → click Outputs tab
Copy WebsiteURL
Paste URL in browser

Expected Output in browser:
Apache Installed via CloudFormation UserData (Amazon Linux 2023)!

Part H — Verify in EC2 
Go to EC2 → Instances
Instance should be running
Security group should allow:
SSH 22
HTTP 80

Troubleshooting (Common Errors)
Website not opening
Check:
EC2 instance status checks are 2/2 passed
Security group has port 80 open
Wait 2–3 minutes (UserData takes time)
Stack went to ROLLBACK
Go to stack → Events tab → check the failure reason
Most common reason: Wrong Key Pair selected / key pair does not exist

Clean-up 
To avoid charges:
CloudFormation → Stacks
Select EC2-Apache-AL2023
Click Delete
Confirm
This deletes EC2 + Security Group automatically.

